# 世界观界面手机适配问题修复报告

## 1. 问题描述
用户反馈在手机端使用世界观界面时，存在概率性触发的布局异常。具体表现为：当向 AI 发送世界观请求并收到回复后，界面宽度超出屏幕范围，导致适配失效。

## 2. 原因分析
经过代码审查和现象分析，确定该问题由以下两个因素共同导致：

### 2.1 长文本渲染问题
AI 生成的回复会自动追加到“用户输入记录 & 设定上下文”的文本框（`textarea`）中。
- 问题根源：生成的记录包含较长的时间戳和内容（如 `[00:21:18] 我们要设计...`）。在某些情况下（特别是移动端或特定字体渲染下），这段长文本被视为不可断行的连续字符串，导致 `textarea` 尝试保持单行显示，从而拥有极大的宽度。
- 虽然 `textarea` 默认通常是 `pre-wrap`，但在缺乏显式断行控制（`break-words`）的情况下，对于某些长字符串的处理可能不符合预期。

### 2.2 Flexbox 布局特性
该界面的主内容区域使用了 Flexbox 布局（`flex-1 flex flex-col`）。
- 问题根源：在 Flexbox 规范中，Flex Item 的默认 `min-width` 是 `auto`，这意味着它不能小于其内容的最小内在宽度。
- 当 `textarea` 因为长文本而变宽时，它撑大了其父级容器（Flex Item）。由于没有设置 `min-width: 0`，父容器被迫扩展以容纳 `textarea` 的宽度，最终导致整个页面宽度溢出，破坏了手机端的响应式布局。

## 3. 解决方案
为了彻底解决此问题并预防类似情况，我们实施了以下修复措施：

### 3.1 限制 Flex Item 宽度
在所有主要功能模块（世界观、角色集、大纲）的内容滚动容器上添加了 `min-w-0` 类。
- **作用**：这覆盖了 Flex Item 默认的 `min-width: auto`，允许容器在空间不足时收缩，而不是被子内容强行撑开。这确保了布局始终受限于屏幕宽度。

### 3.2 强制文本换行
在所有相关的 `textarea` 组件上显式添加了 `whitespace-pre-wrap` 和 `break-words` 类。
- **作用**：
    - `whitespace-pre-wrap`：保留空格和换行符，但允许自动换行。
    - `break-words`：在单词过长无法容纳时强制进行断行。
- 这确保了无论 AI 生成的内容有多长（即使是连续无空格字符），文本框都会在容器宽度内自动换行，而不会尝试无限延伸。

## 4. 修改范围
该修复已应用于以下模块的对应代码区域（`src/App.tsx`）：
1.  **世界观 (Worldview)**：修复了用户报告的问题界面。
2.  **角色集 (Characters)**：预防性修复，因为使用了相同的布局结构。
3.  **大纲 (Outline)**：预防性修复，因为使用了相同的布局结构。

## 5. 验证
修复后，即使 `textarea` 中存在极长的单行文本，它也会自动换行，且外层容器会正确限制在屏幕宽度内，从而恢复手机端的正常适配。
