# AI 小说生成器项目计划书 - 第二部分：多 Agent 详细设计

## 2.1 协同架构设计思想：从线性到博弈

传统的 AI 写作工具通常采用线性工作流：`用户输入 -> 提示词构建 -> 模型生成 -> 用户修改`。这种模式将所有压力都堆积在模型的一次性推理上。

本项目采用**“博弈驱动协作”**架构。我们将 Agent 视为工作室中的不同职能专家，通过多轮博弈提升质量。例如，当“创作 Agent”产出的内容逻辑不通时，“审计 Agent”会驳回该请求并提供具体的修改意见，促使“创作 Agent”进行迭代。

## 2.2 核心 Agent 角色定义与分工

### 2.2.1 导演 Agent (Director Agent) - 任务编排与冲突解决

* **职责**：作为系统的“大脑”，负责解析用户的宏观意图，将其拆解为各个子 Agent 的任务。它还负责在子 Agent 之间出现矛盾时进行仲裁。
* **输入**：用户指令（如：“写一个主角逆袭的高潮章节”）。
* **核心能力**：
  * 状态机管理：控制“设定 -> 大纲 -> 初稿 -> 质检 -> 终稿”的流转。
  * 动态 Prompt 组装：根据任务优先级，决定哪些设定需要发送给下游 Agent。

### 2.2.2 世界观 Agent (Worldview Agent) - 设定守护者

* **职责**：维护小说的地理、势力、力量体系等底层规则。确保所有创作不脱离设定的框架。
* **核心能力**：
  * 设定检索：基于 RAG 技术在向量数据库中检索相关设定。
  * 设定补全：当作者提到一个新地点时，自动为其生成背景细节并存入数据库。

### 2.2.3 角色 Agent (Character Agent) - 灵魂注入者

* **职责**：维护每个角色的性格、外貌、动机和历史经历。
* **核心能力**：
  * 动机推演：模拟角色在特定情境下的反应（如：“以林风那种隐忍的性格，他此时绝不会直接拔剑”）。
  * 关系网管理：记录角色间的动态情感值和关联事件。

### 2.2.4 剧情架构 Agent (Plot Agent) - 节奏控制大师

* **职责**：负责大纲的生成与细化。它专注于“冲突设计”和“钩子（Hooks）”铺设。
* **核心能力**：
  * 节奏分析：检查剧情是否平淡，是否需要在当前章节加入转折。
  * 伏笔库管理：记录已埋下的伏笔及对应的回收章节。

### 2.2.5 创作 Agent (Writer Agent) - 职业执笔者

* **职责**：负责具体的文本产出。
* **核心能力**：
  * 风格迁移：根据用户选择的文风预设（如：古龙风、海明威风）进行写作。
  * 画面感增强：自动填充环境描写和动作细节。

### 2.2.6 逻辑质检 Agent (Critic Agent) - 严厉的校对者

* **职责**：对创作 Agent 产出的草稿进行全方位的逻辑审计和质量评估。
* **核心能力**：
  * 矛盾检测：检查文中是否有与前文冲突的地方（如：明明断了左手，这章却用左手拿杯子）。
  * 文学性评价：评估词汇重复率、句式丰富度。

## 2.3 Agent 间通讯协议 (Agent-to-Agent Protocol)

为了确保 Agent 间的高效协作，我们设计了一套标准的消息交互格式：

```json
{
  "from": "CriticAgent",
  "to": "WriterAgent",
  "action": "REJECT",
  "reason": "逻辑矛盾：主角在第12章已失去修为，此处不应能御剑飞行。",
  "context_refs": ["chapter_12_summary", "world_rule_power_system"],
  "instruction": "请重写此段，改为主角通过智谋或外物解决困难。"
}
```

## 2.4 Agent 运行模式详述

### 2.4.1 被动触发模式

用户手动点击“生成角色”、“生成章节”。导演 Agent 启动对应流向。

### 2.4.2 自动推演模式（Autopilot）

一旦开启，导演 Agent 会自动根据当前大纲，串联“剧情架构 -> 设定检索 -> 角色推演 -> 创作 -> 质检”的全流程，直到生成满足质量阈值的正文。

### 2.4.3 灵感博弈模式

用户输入一个模糊的脑洞，多个子 Agent 会自动开启“头脑风暴”。

* 剧情 Agent 提议一个悲剧结局。
* 角色 Agent 提出抗议，认为这不符合角色成长弧光。
* 最终导演 Agent 综合意见，给出一个平衡的方案。

---
*注：本篇章详细描述了 Agent 的职能，下一篇将讨论长效记忆系统的具体技术实现方案。*
