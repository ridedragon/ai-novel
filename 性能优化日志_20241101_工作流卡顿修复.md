# 性能优化日志 - 20241101

## 问题描述
用户反馈在 985 章节的极端情况下，点击“可视化工作流”会出现随机卡死、无法操作的现象。

## 根因分析
1. **全量同步导致的重绘风暴**：`MobileWorkflowEditor.tsx` 中的 `useEffect` 监听了 `activeNovel`。由于主界面在不断进行增量保存（引发 `activeNovel` 引用变化），导致工作流组件在后台频繁重读 `localStorage` 并重置所有 React Flow 节点，瞬间占满 CPU。
2. **算法重算开销**：`getOrderedNodes`（拓扑排序）在渲染函数中被多次直接调用，没有缓存，造成了不必要的计算开销。
3. **渲染主线程阻塞**：配置面板在打开时即时计算大型数组，未进行 Memoization。

## 优化措施
1. **依赖项瘦身**：
   - 将工作流初始化逻辑与 `activeNovel` 解耦。改为仅在 `isOpen` 为 true 的瞬间执行一次。
   - 使用 `useRef` 保持对最新 `activeNovel` 的访问，而不触发 `useEffect` 重新运行。
2. **计算结果缓存**：
   - 对 `getOrderedNodes` 的结果使用 `useMemo` 进行包裹，依赖项设为 `nodes` 和 `edges`。
3. **性能监控埋点**：
   - 引入渲染时长监控逻辑，实时在 PowerShell 中打印 UI 响应耗时。
   - 如果 `Render -> Commit` 的耗时超过 16ms，打印警报。

## 预期效果
- 彻底消除点击工作流时的掉帧感。
- 即使后台在进行大数据保存，可视化界面也将保持绝对静默，互不干扰。